name: 检查汉化包更新

on:
  # 每小时运行一次（在15分钟时，UTC时间，对应北京时间+8小时）
  # 如果想要北京时间每小时15分执行，应该设置 cron: '15 * * * *' (UTC) 对应北京时间 9:15, 10:15...
  # 如果想要北京时间整点执行，应该设置 cron: '45 * * * *' (UTC 45分 = 北京时间 0分)
  schedule:
    - cron: '15 * * * *'
  # 允许手动触发
  workflow_dispatch:

jobs:
  run-script:
    runs-on: ubuntu-latest
    # 关键：显式指定即使没有推送也运行（针对定时任务）
    if: github.event_name == 'schedule' || github.event_name == 'workflow_dispatch'
    
    steps:
      # 设置时区为东八区（北京时间）- 仅影响脚本内的时间显示，不影响cron执行时间
      - name: 设置时区为东八区（北京时间）
        uses: szenius/set-timezone@v1.2
        with:
          timezoneLinux: "Asia/Shanghai"
      
      # 1. 检出代码
      - name: 检出代码
        uses: actions/checkout@v4
        # 关键：定时任务需要显式获取最新代码
        with:
          fetch-depth: 0
      
      # 2. 设置Python环境
      - name: 设置Python环境
        uses: actions/setup-python@v5
        with:
          python-version: '3.9'
          cache: 'pip'
      
      - name: 下载依赖
        run: |
          python -m pip install --upgrade pip
          pip install requests
      
      # 调试：输出当前时间和触发方式（帮助排查问题）
      - name: 输出调试信息
        run: |
          echo "触发方式: ${{ github.event_name }}"
          echo "当前系统时间: $(date)"
          echo "Python版本: $(python --version)"
      
      # 4. 运行脚本实现汉化包更新检查
      - name: 运行脚本实现汉化包更新检查
        env:
          ADDRESS: ${{ secrets.WEBNOTE_ADDRESS }}
        run: |
          python .github/UpdatePackage.py
